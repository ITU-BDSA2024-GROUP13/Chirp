<form class="cheep-post-form" id="post">
    <input type="text" id="post-input">
    @Html.AntiForgeryToken()
    <div class="post-placeholder" id="post-placeholder"> What's on your mind? </div> 
</form>

<button class="footer-button" onclick="rotate()">
    <img src="/assets/post.png" class="footer-button-image" id="post-button" />
</button>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const postInput = document.getElementById("post-input");

        postInput.addEventListener("focus", () => movePlaceholder());
        postInput.addEventListener("blur", () => movePlaceholder());

        postInput.addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();

                const antiforgeryToken = document.querySelector('input[name="__RequestVerificationToken"]').value;

                fetch(window.location.href, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "RequestVerificationToken": antiforgeryToken
                    },
                    body: JSON.stringify({ 
                        postName: "Helge",
                        postString: postInput.value 
                    })
                })
                .then(response => response.json())
                .then(
                    postInput.value = `${postInput.value} [succes]`
                )
                .catch(error => {
                    console.error("Error:", error);
                    postInput.value = `${postInput.value} [failure]`
                });
            }
        });
    });

    function rotate(){
        const img = document.getElementById("post-button");
        img.style.transform = img.style.transform === "rotate(45deg)" ? "rotate(0deg)" : "rotate(45deg)";
        toggleVisibility();
    }

    function toggleVisibility(){
        const form = document.getElementById("post");
        form.style.visibility = form.style.visibility === "visible" ? "hidden" : "visible";
    }

    function movePlaceholder(){
        const div = document.getElementById("post-placeholder");
        const input = document.getElementById("post-input");

        if (input === document.activeElement) {  // When input is focused
            div.style.top = "4px";
            div.style.color = "rgb(75, 21, 21)";
        } else {  // When input loses focus
            div.style.top = "60px";
            div.style.color = "rgba(75, 21, 21, 0.37)";
            input.value = "";
        }
    } 
</script>
